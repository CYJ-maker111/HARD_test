# 数字电子钟系统

基于 Altera EPM7128 / Xilinx Spartan-6 CPLD/FPGA 的数字电子钟系统设计

## 项目结构

```
digital_clock/
│
├── src/                          # 源代码目录
│   ├── top/
│   │   └── digital_clock_top.v   # 顶层模块
│   ├── clock/
│   │   └── clk_div.v             # 时钟分频模块（备用）
│   ├── counter/
│   │   └── time_counter.v        # 时间计数模块（HH:MM:SS BCD 计数）
│   ├── control/
│   │   └── adjust_ctrl.v         # 校时控制模块
│   ├── display/
│   │   ├── seg7_decoder.v        # BCD 到 7 段译码器
│   │   └── display_output.v      # 时间拆分与显示驱动
│   └── utils/
│       └── edge_detect.v         # 按钮边沿检测（用于 QD 防抖）
│
└── constraints/                  # 约束文件目录
    ├── altera/
    │   └── pin_assign.tdf        # Altera EPM7128 引脚分配
    └── xilinx/
        └── pin_assign.xdc        # Xilinx Spartan-6 引脚约束
```

## 功能特性

- ✅ 基本时间显示功能（时/分/秒，24小时制）
- ✅ 系统时钟分频与计数控制（使用外部CP3 1Hz时钟）
- ✅ 复位功能（CLR#低电平有效）
- ✅ 校时功能（K0使能，K1/K2选择，QD确认）
- ✅ 按钮防抖处理（边沿检测）
- ✅ 静态显示驱动（6位数码管）

## 模块说明

### 1. 顶层模块 (digital_clock_top.v)
- 整合所有子模块
- 处理I/O引脚映射
- 实现复位同步逻辑

### 2. 时间计数模块 (time_counter.v)
- 实现秒、分、时的BCD计数
- 支持进位逻辑（秒→分→时）
- 支持校时模式（暂停自动计时）

### 3. 校时控制模块 (adjust_ctrl.v)
- 解析用户输入（K0, K1, K2, QD）
- 生成校时使能信号
- 集成按钮防抖功能

### 4. 显示输出模块 (display_output.v)
- 将时间数据拆分为6位显示
- 驱动6位数码管静态显示
- 集成7段译码器

### 5. 7段译码器 (seg7_decoder.v)
- BCD码到7段显示码转换
- 支持共阴极数码管

### 6. 边沿检测模块 (edge_detect.v)
- 两级寄存器同步
- 上升沿检测
- 防止亚稳态

### 7. 时钟分频模块 (clk_div.v)
- 备用方案：将高频时钟分频为1Hz
- 优先使用外部CP3信号

## 使用方法

### Altera Quartus II (EPM7128)

1. 创建新项目，选择器件：EPM7128SLC84-15
2. 添加所有 `.v` 源文件到项目
3. 设置顶层模块：`digital_clock_top`
4. 在 Assignment Editor 中分配引脚（参考 `constraints/altera/pin_assign.tdf`）
5. 编译项目
6. 下载到目标器件

### Xilinx ISE/Vivado (Spartan-6)

1. 创建新项目，选择器件：Spartan-6系列
2. 添加所有 `.v` 源文件到项目
3. 设置顶层模块：`digital_clock_top`
4. 添加约束文件 `constraints/xilinx/pin_assign.xdc`（需根据实际开发板修改引脚号）
5. 综合、实现、生成比特流
6. 下载到目标器件

## 引脚分配

### 输入信号
- `CLR_n`: 引脚1 - 复位信号（低有效）
- `CP3`: 引脚58 - 1Hz时钟（秒基准）
- `K0`: 引脚54 - 校时使能
- `K1`: 引脚81 - 小时调整选择
- `K2`: 引脚80 - 分钟调整选择
- `QD`: 引脚60 - 校时确认按钮

### 输出信号
- `LG1_D0~D7`: 引脚44-52 - 秒个位数码管（完整7段+dp）
- `LG2_A~D`: 引脚37,39-41 - 秒十位数码管
- `LG3_A~D`: 引脚35,36,17,18 - 分个位数码管
- `LG4_A~D`: 引脚30-34 - 分十位数码管
- `LG5_A~D`: 引脚25,27-29 - 时个位数码管
- `LG6_A~D`: 引脚20-24 - 时十位数码管

## 校时操作

1. 将 `K0` 置为高电平，进入校时模式（暂停自动计时）
2. 选择调整项目：
   - `K1=1`: 调整小时
   - `K2=1`: 调整分钟
3. 按下 `QD` 按钮，对应的时间单位+1
4. 将 `K0` 置为低电平，退出校时模式，恢复正常计时

## 设计特点

- **模块化设计**：清晰的层次结构，便于维护和扩展
- **资源优化**：优先使用外部1Hz时钟，节省内部资源
- **稳定性**：同步设计，防止亚稳态，按钮防抖处理
- **静态显示**：简化时序设计，提高稳定性

## 注意事项

1. 确保外部CP3信号为准确的1Hz时钟
2. 按钮QD需要防抖处理（已集成在设计中）
3. 复位信号CLR_n为低电平有效
4. 数码管类型需确认（默认按共阴极设计）
5. Xilinx约束文件中的引脚号需要根据实际开发板修改

## 扩展功能（可选）

- 整点报时（使用PULSE信号驱动SPEAKER）
- 12/24小时制切换
- 闹钟功能
- LED状态指示

## 版本信息

- **版本**: V1.0
- **日期**: 2026年1月12日
- **平台**: Altera MAX 7000S (EPM7128) / Xilinx Spartan-6
- **适用场景**: 教学实验、嵌入式数字系统课程设计

2222